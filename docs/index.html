<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Feldbrugge &amp; Hidding" />
  <title>Caustic skeleton of 3D gradient deformation fields</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!-- Bootstrap 4.5.0 stylesheet -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link rel="stylesheet" href="css/mods.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
<!-- <script data-main="scripts/main" src="js/require.js"></script> -->
  <!-- Load React. -->
  <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
<!--  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script> -->


</head>
<body class="d-flex flex-column">

<nav id="TOC" class="navbar navbar-dark bg-dark">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a href="#" class="ml-5 mr-auto navbar-brand">Caustic skeleton of 3D gradient deformation fields<br><span style="font-size: smaller"> 
        by <i>Feldbrugge &amp; Hidding</i></span></a>
<div class="collapse navbar-collapse" id="navbarSupportedContent">
<ul>
<li><a href="#singularities">Singularities</a></li>
<li><a href="#numeric-methods">Numeric methods</a></li>
<li><a href="#cosmology">Cosmology</a></li>
</ul>
</div>
</nav>

<!-- <nav class="navbar navbar-dark navbar-expand-md bg-dark mb-4">
<p class="author">Feldbrugge &amp; Hidding</p>
</nav>
 -->

<main role="main" class="flex-fill"><div class="container my-5">
<p>Lagrangian map:</p>
<p><span class="math display">\[\vec{x}(t) = \vec{q} + D \vec{v}(D).\]</span></p>
<p>Hessian:</p>
<p><span class="math display">\[H_{ij} = \frac{\partial v_i}{\partial x_j}.\]</span></p>
<p>We have eigenvalues <span class="math inline">\(\alpha \le \beta \le \gamma\)</span> and corresponding eigenvectors <span class="math inline">\(v_{\alpha}\)</span>, <span class="math inline">\(v_{\beta}\)</span>, <span class="math inline">\(v_{\gamma}\)</span>. Alternatively we may write <span class="math inline">\(\lambda_1 \dots \lambda_3\)</span> and <span class="math inline">\(v_1 \dots v_3\)</span>.</p>
<h1 id="singularities">Singularities</h1>
<p><span class="math inline">\(A_2\)</span> or fold singularities can be found where <span class="math inline">\(D = 1/\lambda_i\)</span>.</p>
<p><span class="math inline">\(A_3\)</span> or cusp singularities can be found where <span class="math inline">\(v_i \cdot \grad lambda_i = 0.\)</span></p>
<p>We know how to find these in 2D from Hidding 2014, which can be extended to 3D.</p>
<h1 id="numeric-methods">Numeric methods</h1>
<p>We assume the values of the Hessian are known at grid points. By means of interpolation we can compute continuous functional representations of the eigenvalue and eigenvector fields.</p>
<p>Each cube on the grid is divided into six tetrahedra. To compute <span class="math inline">\(A_2\)</span> singularities we want to extract the level set for <span class="math inline">\(\lambda_i = 1/D\)</span>. We use marching tetrahedra algorithm on the interpolated eigenvalue function. This gives us a guaranteed manifold with correct structure (i.e. no boundary).</p>
<h2 id="marching-tetrahedra">Marching tetrahedra</h2>
<p>Given a tetrahedron we may find the species of resulting triangle by comparing vertex values to the iso contour level, where earch vertex is assigned a bit (e.g. 0 for smaller than x, 1 for larger or equal to x), resulting in one of 16 possible geometries, ranging from empty, to triangle or quadrilangle. Due to symmetry only 8 unique cases arise.</p>
<p>First <span class="math inline">\(A_2\)</span> is computed for each tetrahedron separately, then the intersection of <span class="math inline">\(A_3\)</span> surfaces with <span class="math inline">\(A_2\)</span> can be computed for that specific time <span class="math inline">\(D\)</span>.</p>
<p>In a similar way we can compute the entire <span class="math inline">\(D_3\)</span> surface (the bigcaustic), and recursively <span class="math inline">\(A_4\)</span> lines are found on this surface, and <span class="math inline">\(A_5\)</span> on the <span class="math inline">\(A_4\)</span> lines. For each step in this cascade we have the following constraints:</p>
<table>
<thead>
<tr class="header">
<th>caustic</th>
<th>constraint</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(A_3\)</span></td>
<td><span class="math inline">\(v_i \cdot \grad \lambda_i = 0\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(A_4\)</span></td>
<td><span class="math inline">\(v_i \cdot \grad (v_i \cdot \grad \lambda_i) = 0\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(A_5\)</span></td>
<td><span class="math inline">\(v_i \cdot \grad (v_i \cdot \grad (v_i \cdot \lambda_i)) = 0\)</span></td>
</tr>
</tbody>
</table>
<h2 id="d_4"><span class="math inline">\(D_4\)</span></h2>
<p>This is the hard one. Feldbrugge (eq 4.15-17) derived a set of conditions which we can use to detect those places where <span class="math display">\[\alpha = \beta\quad {\rm or}\quad \beta = \gamma.\]</span> To remind ourselves, why is this so hard? We have methods of computing the eigenvalues such that <span class="math inline">\(\alpha \ge \beta \ge \gamma\)</span>. We used Cardano’s formula on the characteristic equation of the Hessian to find these. It is not possible however, to find a good continuous representation where these fields are disambiguated such that we can compute the level set of say (<span class="math inline">\(\alpha - \beta\)</span>). To understand this we should learn about the geometry of the eigenvalue fields: near points where we expect <span class="math inline">\(\alpha = \beta\)</span>, on a 2D domain these fields assume the shape of a cone. From generic fields with transverse crossings we would expect these to intersect in a line, however, we find only points. In 3D the equation <span class="math inline">\(\alpha = \beta\)</span> yields curves, again one dimension less than we would expect from a naive level set. We need to expand the condition to a set of at least two conditions, to arrive at curves.</p>
<p><span class="math display">\[\begin{align}
C_1: &amp;H_{11} H_{13} H_{23} + H_{12} H_{23}^2 = H_{22} H_{13} H_{23} + H_{12} H_{13}^2\\
C_2: &amp;H_{22} H_{12} H_{13} + H_{23} H_{13}^2 = H_{33} H_{12} H_{13} + H_{23} H_{12}^2\\
C_3: &amp;H_{33} H_{23} H_{12} + H_{13} H_{12}^2 = H_{11} H_{23} H_{12} + H_{13} H_{23}^2
\end{align}\]</span></p>
<p>Two of these conditions suffice to compute the <span class="math inline">\(D_4\)</span> singularities, but where they differ is in their numerical stability. If say <span class="math inline">\(H_{12}\)</span> is large compared to <span class="math inline">\(H_{13}\)</span> and <span class="math inline">\(H_{23}\)</span>, it makes more sense to use <span class="math inline">\(C_2\)</span> and <span class="math inline">\(C_3\)</span> over <span class="math inline">\(C_1\)</span>. Note that the relations are completely cyclic.</p>
<h1 id="cosmology">Cosmology</h1>
<p>For our cosmology we only consider <span class="math inline">\(h\)</span>, <span class="math inline">\(\Omega_m\)</span> and <span class="math inline">\(\Omega_{\Lambda}\)</span> as parameters.</p>
<div class="annotated-code">
<p><span><em>«cosmology-parameters»=</em></span></p>
<div class="sourceCode" id="cosmology-parameters"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cosmology-parameters-1"><a href="#cosmology-parameters-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="op">,</span> <span class="bu">Clone</span><span class="at">)]</span></span>
<span id="cosmology-parameters-2"><a href="#cosmology-parameters-2" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> Cosmology <span class="op">{</span></span>
<span id="cosmology-parameters-3"><a href="#cosmology-parameters-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> h<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cosmology-parameters-4"><a href="#cosmology-parameters-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> omega_m<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cosmology-parameters-5"><a href="#cosmology-parameters-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> omega_l<span class="op">:</span> <span class="dt">f64</span></span>
<span id="cosmology-parameters-6"><a href="#cosmology-parameters-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>The Friedman equation for such a universe is as follows,</p>
<p><span class="math display">\[\left(\frac{H}{H_0}\right)^2 = \Omega_m a^{-3} + (1 - \Omega_m - \Omega_{\Lambda}) a^{-2} + \Omega_{\Lambda}.\]</span></p>
<div class="annotated-code">
<p><span><em>«friedman-equation»=</em></span></p>
<div class="sourceCode" id="friedman-equation"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="friedman-equation-1"><a href="#friedman-equation-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> friedman_eqn(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> a<span class="op">:</span> <span class="dt">f64</span>) <span class="op">-&gt;</span> <span class="dt">f64</span> <span class="op">{</span></span>
<span id="friedman-equation-2"><a href="#friedman-equation-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">self</span><span class="op">.</span>omega_m <span class="op">*</span> a<span class="op">.</span>powf(<span class="op">-</span><span class="dv">3.0</span>) <span class="op">+</span> (<span class="dv">1.0</span> <span class="op">-</span> <span class="kw">self</span><span class="op">.</span>omega_m <span class="op">-</span> <span class="kw">self</span><span class="op">.</span>omega_l) <span class="op">*</span> a<span class="op">.</span>powf(<span class="op">-</span><span class="dv">2.0</span>) <span class="op">+</span> <span class="kw">self</span><span class="op">.</span>omega_l</span>
<span id="friedman-equation-3"><a href="#friedman-equation-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>For Einstein-de Sitter or concordance universes this equation suffices to compute the function <span class="math inline">\(a(t)\)</span>, the scale factor as a function of time in seconds.</p>
<div class="annotated-code">
<p><span><em>«scale-factor-da»=</em></span></p>
<div class="sourceCode" id="scale-factor-da"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="scale-factor-da-1"><a href="#scale-factor-da-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> da(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> a<span class="op">:</span> <span class="dt">f64</span>) <span class="op">-&gt;</span> <span class="dt">f64</span> <span class="op">{</span></span>
<span id="scale-factor-da-2"><a href="#scale-factor-da-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">self</span><span class="op">.</span>friedman_eqn(a)<span class="op">.</span>sqrt() <span class="op">*</span> <span class="dv">100.0</span> <span class="op">*</span> <span class="kw">self</span><span class="op">.</span>h <span class="op">*</span> a <span class="op">*</span> KM_PER_MPC</span>
<span id="scale-factor-da-3"><a href="#scale-factor-da-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>Because the resulting equation explodes for small <span class="math inline">\(a\)</span>, we need to use an approximation there. When <span class="math inline">\(a\)</span> is small, the term with <span class="math inline">\(a^{-3}\)</span> dominates. The equation for a matter-dominated universe can be directly solved using an ansatz of <span class="math inline">\(a \sim t^n\)</span>. We arrive at the limiting case,</p>
<p><span class="math display">\[a_{\rm matter}(t) = \left(\frac{3}{2} \sqrt{\Omega_m} H_0 t\right)^{2/3}.\]</span></p>
<div class="annotated-code">
<p><span><em>«scale-factor-limit»=</em></span></p>
<div class="sourceCode" id="scale-factor-limit"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="scale-factor-limit-1"><a href="#scale-factor-limit-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> limit_a(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> t<span class="op">:</span> <span class="dt">f64</span>) <span class="op">-&gt;</span> <span class="dt">f64</span> <span class="op">{</span></span>
<span id="scale-factor-limit-2"><a href="#scale-factor-limit-2" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">self</span><span class="op">.</span>omega_m<span class="op">.</span>sqrt() <span class="op">*</span> <span class="dv">3.0</span> <span class="op">*</span> t <span class="op">*</span> <span class="dv">100.0</span> <span class="op">*</span> <span class="kw">self</span><span class="op">.</span>h <span class="op">*</span> KM_PER_MPC <span class="op">/</span> <span class="dv">2.0</span>)<span class="op">.</span>powf(<span class="dv">2.0</span><span class="op">/</span><span class="dv">3.0</span>)</span>
<span id="scale-factor-limit-3"><a href="#scale-factor-limit-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="scale-factor-limit-4"><a href="#scale-factor-limit-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="scale-factor-limit-5"><a href="#scale-factor-limit-5" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>cfg<span class="at">(</span>test<span class="at">)]</span></span>
<span id="scale-factor-limit-6"><a href="#scale-factor-limit-6" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> limit_t(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> a<span class="op">:</span> <span class="dt">f64</span>) <span class="op">-&gt;</span> <span class="dt">f64</span> <span class="op">{</span></span>
<span id="scale-factor-limit-7"><a href="#scale-factor-limit-7" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span>powf(<span class="dv">3.0</span> <span class="op">/</span> <span class="dv">2.0</span>) <span class="op">*</span> <span class="dv">2.0</span> <span class="op">/</span> (<span class="kw">self</span><span class="op">.</span>omega_m<span class="op">.</span>sqrt() <span class="op">*</span> <span class="dv">3.0</span> <span class="op">*</span> <span class="dv">100.0</span> <span class="op">*</span> <span class="kw">self</span><span class="op">.</span>h <span class="op">*</span> KM_PER_MPC)</span>
<span id="scale-factor-limit-8"><a href="#scale-factor-limit-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h2 id="growing-mode-solution">Growing mode solution</h2>
<p>The growing-mode solution <span class="math inline">\(D\)</span> can be computed as function of the scale factor <span class="math inline">\(a\)</span> using the integral expression,</p>
<p><span class="math display">\[D(a) \propto \frac{\dot{a}}{a} \int_0^a \frac{{\rm d}a&#39;}{\dot{a}&#39;^3}.\]</span></p>
<p>In the limit of small <span class="math inline">\(a\)</span> we may choose to have <span class="math inline">\(D(a) = a\)</span>, adding a factor <span class="math inline">\(\frac{5}{2} H_0^2 \Omega_m\)</span>. In doing this, we may drop all factors of <span class="math inline">\(H_0\)</span> from the computation.</p>
<div class="annotated-code">
<p><span><em>«growing-mode»=</em></span></p>
<div class="sourceCode" id="growing-mode"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="growing-mode-1"><a href="#growing-mode-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> growing_mode(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> a<span class="op">:</span> <span class="dt">f64</span>) <span class="op">-&gt;</span> <span class="dt">f64</span> <span class="op">{</span></span>
<span id="growing-mode-2"><a href="#growing-mode-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> integrant <span class="op">=</span> <span class="op">|</span>a<span class="op">|</span> <span class="op">{</span></span>
<span id="growing-mode-3"><a href="#growing-mode-3" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">self</span><span class="op">.</span>friedman_eqn(a)<span class="op">.</span>sqrt() <span class="op">*</span> a)<span class="op">.</span>powf(<span class="op">-</span><span class="dv">3.0</span>)</span>
<span id="growing-mode-4"><a href="#growing-mode-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="growing-mode-5"><a href="#growing-mode-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="growing-mode-6"><a href="#growing-mode-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> A_SMALL<span class="op">:</span> <span class="dt">f64</span> <span class="op">=</span> <span class="dv">0.001</span><span class="op">;</span></span>
<span id="growing-mode-7"><a href="#growing-mode-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> a <span class="op">&lt;</span> A_SMALL <span class="op">{</span></span>
<span id="growing-mode-8"><a href="#growing-mode-8" aria-hidden="true" tabindex="-1"></a>        a</span>
<span id="growing-mode-9"><a href="#growing-mode-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="growing-mode-10"><a href="#growing-mode-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> int_init  <span class="op">=</span> <span class="dv">0.4</span> <span class="op">*</span> A_SMALL<span class="op">.</span>powf(<span class="dv">2.5</span>) <span class="op">*</span> <span class="kw">self</span><span class="op">.</span>omega_m<span class="op">.</span>powf(<span class="op">-</span><span class="dv">1.5</span>)<span class="op">;</span></span>
<span id="growing-mode-11"><a href="#growing-mode-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> (int_rest<span class="op">,</span> _<span class="op">,</span> _<span class="op">,</span> _) <span class="op">=</span> <span class="pp">rgsl::integration::</span>qk15(integrant<span class="op">,</span> A_SMALL<span class="op">,</span> a)<span class="op">;</span></span>
<span id="growing-mode-12"><a href="#growing-mode-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> hubble_factor <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>friedman_eqn(a)<span class="op">.</span>sqrt()<span class="op">;</span></span>
<span id="growing-mode-13"><a href="#growing-mode-13" aria-hidden="true" tabindex="-1"></a>        (int_init <span class="op">+</span> int_rest) <span class="op">*</span> hubble_factor <span class="op">*</span> <span class="dv">2.5</span> <span class="op">*</span> <span class="kw">self</span><span class="op">.</span>omega_m</span>
<span id="growing-mode-14"><a href="#growing-mode-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="growing-mode-15"><a href="#growing-mode-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h2 id="tests">Tests</h2>
<div class="annotated-code">
<p><span><em>«src/cosmology.rs»=</em></span></p>
<div class="sourceCode" id="cb1" data-file="src/cosmology.rs"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="kw">crate</span> rgsl<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">const</span> KM_PER_MPC<span class="op">:</span> <span class="dt">f64</span> <span class="op">=</span> <span class="dv">3.24077929e-20</span><span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">const</span> SEC_PER_GYR<span class="op">:</span> <span class="dt">f64</span> <span class="op">=</span> <span class="dv">3.15576e16</span><span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>cosmology<span class="op">-</span>parameters<span class="op">&gt;&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">const</span> PLANCK_COSMOLOGY<span class="op">:</span> Cosmology <span class="op">=</span> Cosmology <span class="op">{</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    h<span class="op">:</span> <span class="dv">0.678</span><span class="op">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    omega_m<span class="op">:</span> <span class="dv">0.308</span><span class="op">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    omega_l<span class="op">:</span> <span class="dv">0.692</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">const</span> EDS_COSMOLOGY<span class="op">:</span> Cosmology <span class="op">=</span> Cosmology <span class="op">{</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    h<span class="op">:</span> <span class="dv">0.7</span><span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    omega_m<span class="op">:</span> <span class="dv">1.0</span><span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    omega_l<span class="op">:</span> <span class="dv">0.0</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> euler_method<span class="op">&lt;</span>F1<span class="op">,</span> Pred<span class="op">&gt;</span>(dy<span class="op">:</span> F1<span class="op">,</span> t0<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span> y0<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span> dt<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span> stop<span class="op">:</span> Pred) <span class="op">-&gt;</span> (<span class="dt">f64</span><span class="op">,</span> <span class="dt">f64</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> F1<span class="op">:</span> <span class="bu">Fn</span>(<span class="dt">f64</span>) <span class="op">-&gt;</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>          Pred<span class="op">:</span> <span class="bu">Fn</span>(<span class="dt">f64</span><span class="op">,</span> <span class="dt">f64</span>) <span class="op">-&gt;</span> <span class="dt">bool</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> t <span class="op">=</span> t0<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> y <span class="op">=</span> y0<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="op">!</span>stop(t<span class="op">,</span> y) <span class="op">{</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        y <span class="op">+=</span> dt <span class="op">*</span> dy(y)<span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        t <span class="op">+=</span> dt<span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    (t<span class="op">,</span> y)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> Cosmology <span class="op">{</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>friedman<span class="op">-</span>equation<span class="op">&gt;&gt;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>scale<span class="op">-</span>factor<span class="op">-</span>da<span class="op">&gt;&gt;</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>scale<span class="op">-</span>factor<span class="op">-</span>limit<span class="op">&gt;&gt;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>growing<span class="op">-</span>mode<span class="op">&gt;&gt;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> <span class="kw">fn</span> t0(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">f64</span> <span class="op">{</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> t0 <span class="op">=</span> <span class="dv">0.01</span> <span class="op">*</span> SEC_PER_GYR<span class="op">;</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> dt <span class="op">=</span> <span class="dv">0.01</span> <span class="op">*</span> SEC_PER_GYR<span class="op">;</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> a0 <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>limit_a(t0)<span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> (age<span class="op">,</span> _) <span class="op">=</span> euler_method(</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span>a<span class="op">|</span> <span class="kw">self</span><span class="op">.</span>da(a)<span class="op">,</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            t0<span class="op">,</span> a0<span class="op">,</span> dt<span class="op">,</span> <span class="op">|</span>_<span class="op">,</span> a<span class="op">|</span> <span class="op">{</span> a <span class="op">&gt;=</span> <span class="dv">1.0</span> <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        age</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>cfg<span class="at">(</span>test<span class="at">)]</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="kw">mod</span> tests <span class="op">{</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="kw">super</span><span class="pp">::</span><span class="op">*;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="pp">assert_approx_eq::</span>assert_approx_eq<span class="op">;</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>test<span class="at">]</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> test_age_of_universe() <span class="op">{</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_approx_eq!</span>(PLANCK_COSMOLOGY<span class="op">.</span>t0() <span class="op">/</span> SEC_PER_GYR<span class="op">,</span> <span class="dv">13.8</span><span class="op">,</span> <span class="dv">0.1</span>)<span class="op">;</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>test<span class="at">]</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> test_limit_fn() <span class="op">{</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> t0 <span class="op">=</span> <span class="dv">0.01</span><span class="op">;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> a0 <span class="op">=</span> PLANCK_COSMOLOGY<span class="op">.</span>limit_a(t0)<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_approx_eq!</span>(t0<span class="op">,</span> PLANCK_COSMOLOGY<span class="op">.</span>limit_t(a0)<span class="op">,</span> <span class="dv">1e-6</span>)<span class="op">;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div></main>



<!-- Bootstrap 4.5.0 -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

<!-- Mathjax -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
